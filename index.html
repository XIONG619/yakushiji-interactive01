<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>インタラクティブ動画クイズ｜薬師寺（YouTube対応）</title>
  <style>
    :root{--bg:#0a0f1a;--panel:#0f172a;--ink:#e6edf3;--muted:#9aa4b2;--brand:#22d3ee;--accent:#22c55e;--danger:#ef4444;--ring:rgba(34,211,238,.35)}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans JP,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;background:radial-gradient(1000px 600px at 20% -10%,rgba(34,211,238,.08),transparent) ,radial-gradient(900px 500px at 120% 0%,rgba(34,197,94,.06),transparent) ,linear-gradient(180deg,#070b13,#0b1320 30%,#0d1628);color:var(--ink)}
    .container{max-width:1000px;margin:0 auto;padding:28px}
    .card{background:rgba(15,23,42,.8);border:1px solid rgba(255,255,255,.06);border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,.35);overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:18px 22px;border-bottom:1px solid rgba(255,255,255,.08);background:linear-gradient(90deg, rgba(34,211,238,.15), transparent)}
    header h1{margin:0;font-size:1.15rem;letter-spacing:.02em}
    .score{font-weight:800}
    .section{padding:22px}
    .title{font-size:1.1rem;font-weight:800;margin:0 0 8px}
    .meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:6px 0 14px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.07);color:var(--muted);font-size:.86rem}
    .player-wrap{position:relative;border-radius:16px;overflow:hidden;border:1px solid rgba(255,255,255,.08);background:#000}
    .aspect{width:100%;aspect-ratio:16/9}
    .quiz{margin-top:18px;display:none;animation:fade .3s ease}
    .quiz.active{display:block}
    .q{margin:16px 0;padding:16px;border-radius:14px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
    .q h3{margin:0 0 10px;font-size:1rem}
    .choices{display:grid;gap:10px}
    .choice{display:flex;gap:10px;align-items:flex-start;padding:12px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:rgba(255,255,255,.02);cursor:pointer}
    .choice:focus-within{outline:2px solid var(--ring);outline-offset:2px}
    .choice input{margin-top:2px}
    .actions{display:flex;gap:12px;margin-top:16px}
    button{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
    .btn-primary{background:var(--brand);color:#00242b}
    .btn-secondary{background:rgba(255,255,255,.08);color:var(--ink)}
    .btn-next{background:var(--accent);color:#062a12}
    .btn-disabled{opacity:.55;cursor:not-allowed}
    .feedback{margin-top:10px;font-weight:800}
    .ok{color:var(--accent)}
    .ng{color:var(--danger)}
    .small{font-size:.85rem;color:var(--muted);font-weight:400}
    .summary{display:none;padding:22px}
    .summary.active{display:block}
    .hr{height:1px;background:rgba(255,255,255,.1);margin:16px 0}
    .progress{height:6px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--brand),#60a5fa);transition:width .3s ease}
    @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <h1>インタラクティブ動画クイズ｜薬師寺（YouTube）</h1>
        <div class="score" id="score">得点：0</div>
      </header>
      <div class="section">
        <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
      </div>
      <div class="section" id="app"><!-- app mounts here --></div>
    </div>
  </div>

  <!-- YouTube の貼り方：
       下の SEGMENTS 配列の "youtubeId" に
       https://www.youtube.com/watch?v=XXXXXXXXXXX の XXXXXXXXXXX 部分だけ入れる。
       今回は指定済み：
       part01 → ypff9INMU5k
       part02 → _x1O9JmCAbw
       part03 → WVDkx7X6SuY
  -->

  <script>
    const SEGMENTS = [
      {
        title: "伽藍配置と現況（パート1）",
        youtubeId: "ypff9INMU5k", // ← part01
        questions: [
          {
            type: "single",
            prompt: "薬師寺の中軸線上（南→北）の正しい並びは？",
            choices: [
              { text: "中門→金堂→講堂", correct: true },
              { text: "南大門→講堂→金堂", correct: false },
              { text: "金堂→中門→講堂", correct: false },
              { text: "講堂→塔→金堂", correct: false }
            ],
            points: 10,
            explanation: "南から中門・金堂・講堂が一直線に並ぶ。"
          },
          {
            type: "single",
            prompt: "現在の薬師寺で拡張されたものは？",
            choices: [
              { text: "南大門（三間→五間）と回廊（単廊→複廊）", correct: true },
              { text: "金堂（単層→三層）", correct: false },
              { text: "講堂（木造→鉄筋）", correct: false },
              { text: "東塔（五重→三重）", correct: false }
            ],
            points: 10,
            explanation: "南大門は三間→五間、回廊は単廊→複廊に拡張された。"
          },
          {
            type: "single",
            prompt: "『薬師寺縁起絵巻』の作者と制作年は？",
            choices: [
              { text: "明誉古磵・1716年（享保元）", correct: true },
              { text: "作者不詳・平安末期", correct: false },
              { text: "狩野永徳・桃山時代", correct: false },
              { text: "土佐光起・江戸後期", correct: false }
            ],
            points: 10,
            explanation: "明誉古磵が1716年に描いた。"
          },
          {
            type: "single",
            prompt: "回廊（回郎）はどのように配置されていたか？",
            choices: [
              { text: "中門の両側から講堂の両側まで延び、中枢伽藍を囲んでいた", correct: true },
              { text: "金堂だけを囲む小さな回廊だった", correct: false },
              { text: "講堂の北側だけに並ぶ片側式だった", correct: false },
              { text: "塔をぐるぐる囲む円形配置だった", correct: false }
            ],
            points: 10,
            explanation: "回廊は中門側から講堂側まで延びて中心伽藍を取り囲んでいた。"
          },
          {
            type: "single",
            prompt: "現在の薬師寺の基本方針として最も近いものはどれ？",
            choices: [
              { text: "藤原京の本薬師寺の規格をできるだけ守ろうとしている", correct: true },
              { text: "現代建築の意匠に全面的に切り替えている", correct: false },
              { text: "塔だけを保存し他は再建しない方針", correct: false },
              { text: "伽藍配置を左右非対称に改めた", correct: false }
            ],
            points: 10,
            explanation: "基本的に藤原京期の本薬師寺の規格を踏まえて復元・整備している。"
          },
          {
            type: "single",
            prompt: "『薬師寺縁起絵巻』に描かれる本尊造立場面について正しいのは？",
            choices: [
              { text: "現本尊と全く同じ姿が再現されている", correct: false },
              { text: "現本尊とは少し違うが、台座にある裳懸の表現は共通している", correct: true },
              { text: "阿修羅像の制作風景が中心である", correct: false },
              { text: "作者は仏画を一切残していない", correct: false }
            ],
            points: 10,
            explanation: "姿はやや異なるが、台座の裳懸（もかけ）は共通とされる。"
          }
        ]
      },
      {
        title: "金堂復興と百万巻写経（パート2）",
        youtubeId: "_x1O9JmCAbw", // ← part02
        questions: [
          {
            type: "single",
            prompt: "金堂復興の資金調達として採られた方針は？",
            choices: [
              { text: "大企業寄付中心", correct: false },
              { text: "国費のみ", correct: false },
              { text: "百万巻写経勧進による広募", correct: true },
              { text: "海外財団の助成のみ", correct: false }
            ],
            points: 10,
            explanation: "高田管長は『百万巻写経勧進』で一般の人々から浄財を集めることを発願した。"
          },
          {
            type: "single",
            prompt: "薬師三尊の正しい組み合わせは？",
            choices: [
              { text: "中尊：薬師如来／左：日光菩薩／右：月光菩薩", correct: true },
              { text: "中尊：阿弥陀如来／左：観音／右：勢至", correct: false },
              { text: "中尊：大日如来／左：不動明王／右：愛染明王", correct: false },
              { text: "中尊：釈迦如来／左：弥勒菩薩／右：観音菩薩", correct: false }
            ],
            points: 10,
            explanation: "薬師如来を中心に、日光・月光菩薩が脇侍となる。"
          },
          {
            type: "single",
            prompt: "日光・月光菩薩の信仰形態として最も近いのは？",
            choices: [
              { text: "単独での信仰・造像が非常に盛ん", correct: false },
              { text: "薬師如来の脇侍として造像されるのが基本", correct: true },
              { text: "西方極楽浄土の主尊として信仰される", correct: false },
              { text: "密教以外では信仰されない", correct: false }
            ],
            points: 10,
            explanation: "日光・月光菩薩は薬師如来の左右に侍る形で表されるのが通例。"
          },
          {
            type: "single",
            prompt: "かつての金堂の状態として正しいのはどれ？",
            choices: [
              { text: "常に完全な姿で残っており修理は不要だった", correct: false },
              { text: "450年前に焼失し仮堂のまま老朽化、雨の日は傘をさして勤行するほどだった", correct: true },
              { text: "江戸時代に鉄筋コンクリートで再建済みだった", correct: false },
              { text: "台風で屋根が飛び、以後は未使用となった", correct: false }
            ],
            points: 10,
            explanation: "焼失後は仮堂で雨漏りもひどく、老朽化が深刻だった。"
          },
          {
            type: "single",
            prompt: "金堂復興に必要とされた費用はおよそいくらとされたか？",
            choices: [
              { text: "1千万円", correct: false },
              { text: "1億円", correct: false },
              { text: "10億円", correct: true },
              { text: "100億円", correct: false }
            ],
            points: 10,
            explanation: "復興には約10億円が必要とされた。"
          },
          {
            type: "single",
            prompt: "日光菩薩・月光菩薩の役割説明として正しいのは？",
            choices: [
              { text: "日光菩薩は清涼さで煩悩の熱を冷ますとされる", correct: false },
              { text: "月光菩薩は一千の光明で無明の闇を滅するとされる", correct: false },
              { text: "日光菩薩は無明の闇を光で照らし、月光菩薩は清涼さで衆生を煩悩の焦熱から離れさせる", correct: true },
              { text: "両者とも戦勝祈願専門の護法神とされる", correct: false }
            ],
            points: 10,
            explanation: "日光は光で無明を破り、月光は清涼で苦しみを和らげると説かれる。"
          }
        ]
      },
      {
        title: "塔と瓦・講堂復元（パート3）",
        youtubeId: "WVDkx7X6SuY", // ← part03
        questions: [
          {
            type: "single",
            prompt: "東塔が『六重』に見える主因は？",
            choices: [
              { text: "各層に裳階（もこし）が付く", correct: true },
              { text: "実際は六重塔である", correct: false },
              { text: "心柱が二重構造だから", correct: false },
              { text: "相輪が二段構成だから", correct: false }
            ],
            points: 10,
            explanation: "東塔は三重塔だが各層に裳階が付いて六重塔のように見える。"
          },
          {
            type: "single",
            prompt: "西塔復元に関する正しい記述はどれ？",
            choices: [
              { text: "1528年に兵火で焼失し、1976年の発掘調査を経て創建時の姿に復元された", correct: true },
              { text: "江戸前期に焼失し、昭和初期に鉄筋コンクリートで再建された", correct: false },
              { text: "近世まで無傷で残り、平成に初めて焼失した", correct: false },
              { text: "発掘調査は行われていない", correct: false }
            ],
            points: 10,
            explanation: "西塔は1528年に焼失。1976年の調査をもとに復元された。"
          },
          {
            type: "single",
            prompt: "創建期の薬師寺式軒平瓦（軒平瓦）の特徴として正しいのは？",
            choices: [
              { text: "下辺に鋸歯文、上辺に連珠文が表される", correct: true },
              { text: "上辺に鋸歯文、下辺に連珠文が表される", correct: false },
              { text: "忍冬唐草文は用いられない", correct: false },
              { text: "金堂では出土していない", correct: false }
            ],
            points: 10,
            explanation: "創建期には変形忍冬唐草文などとともに、下：鋸歯文／上：連珠文の意匠が見られる。"
          },
          {
            type: "single",
            prompt: "復元された西塔の高さ（基壇高を含む）として最も近いのは？",
            choices: [
              { text: "約20m", correct: false },
              { text: "約36.4m", correct: true },
              { text: "約50m", correct: false },
              { text: "約72m", correct: false }
            ],
            points: 10,
            explanation: "西塔は基壇高を含めて高さおよそ36.4m。"
          },
          {
            type: "single",
            prompt: "講堂と金堂の関係として、古代伽藍の約束事にもっとも近いのは？",
            choices: [
              { text: "金堂の方が講堂より大きい", correct: false },
              { text: "講堂の方が金堂より大きい", correct: true },
              { text: "常に同じ大きさにする決まり", correct: false },
              { text: "塔の方が最大で堂は小さいと定められている", correct: false }
            ],
            points: 10,
            explanation: "南都仏教では教学重視で、講堂に多くの学僧が集まり法会も行われたため講堂が大きい。"
          },
          {
            type: "single",
            prompt: "現在の薬師寺講堂復元について正しいのは？",
            choices: [
              { text: "1852年に仮講堂が建てられた後、発掘調査や文献をもとに巨大な木造建築として再建された", correct: true },
              { text: "奈良時代のオリジナル建物が完全に残っている", correct: false },
              { text: "鉄骨造で小規模に建て替えられ、柱は直径20cm程度", correct: false },
              { text: "再建はされておらず更地のまま", correct: false }
            ],
            points: 10,
            explanation: "2度焼失後、1852年に縮小仮講堂→その後の調査をもとに大規模木造で復元。柱径は約72cmと極太。"
          }
        ]
      },
      {
        title: "総合テスト（パート1〜3の復習）",
        finalOnly: true,
        questions: [
          {
            type: "single",
            prompt: "薬師寺を発願した天皇として正しいのは？",
            choices: [
              { text: "天武天皇", correct: true },
              { text: "聖武天皇", correct: false },
              { text: "桓武天皇", correct: false },
              { text: "天智天皇", correct: false }
            ],
            points: 10,
            explanation: "薬師寺は天武天皇が皇后（のちの持統天皇）の病平癒を願って発願した。"
          },
          {
            type: "single",
            prompt: "東塔はその優美な姿から何と呼ばれることがあるか？",
            choices: [
              { text: "眠れる炎", correct: false },
              { text: "凍れる音楽", correct: true },
              { text: "燃える静寂", correct: false },
              { text: "歩く曼荼羅", correct: false }
            ],
            points: 10,
            explanation: "東塔はリズミカルな姿と相輪上部の水煙の天人装飾から『凍れる音楽』と称されることがある。"
          },
          {
            type: "single",
            prompt: "西塔再建時、心礎には何が納められたか？",
            choices: [
              { text: "鏡と勾玉", correct: false },
              { text: "刀剣と甲冑", correct: false },
              { text: "仏舎利（平山郁夫寄進）", correct: true },
              { text: "古文書の写本", correct: false }
            ],
            points: 10,
            explanation: "日本画家・平山郁夫から寄進された仏舎利が心礎に納入された。"
          },
          {
            type: "single",
            prompt: "薬師三尊の中尊はどの仏か？",
            choices: [
              { text: "薬師如来", correct: true },
              { text: "阿弥陀如来", correct: false },
              { text: "大日如来", correct: false },
              { text: "釈迦如来", correct: false }
            ],
            points: 10,
            explanation: "薬師三尊は薬師如来を中尊とし、日光・月光菩薩が脇侍となる。"
          },
          {
            type: "single",
            prompt: "回廊は何を取り囲むように配置されていたか？",
            choices: [
              { text: "中心伽藍を取り囲むように延びていた", correct: true },
              { text: "南大門だけをぐるっと囲んでいた", correct: false },
              { text: "西塔のみを円形に取り囲んでいた", correct: false },
              { text: "講堂北側の一列だけに存在した", correct: false }
            ],
            points: 10,
            explanation: "回廊は中門側から講堂側まで延びて中心伽藍全体を囲んでいた。"
          }
        ]
      }
    ];

    // ===== 実装部（YouTube IFrame API＋最終テスト対応） =====
    let totalScore = 0;
    let current = 0;
    const app = document.getElementById('app');
    const scoreBox = document.getElementById('score');
    const bar = document.getElementById('bar');

    function updateScore(delta=0){
      totalScore += delta;
      scoreBox.textContent = `得点：${totalScore}`;
    }
    function updateBar(){
      const pct = ((current) / SEGMENTS.length) * 100;
      bar.style.width = pct + '%';
    }

    // --- YouTube API ロード
    let YT_READY = false;
    const onYouTubeIframeAPIReadyCallbacks = [];
    function loadYT(){
      return new Promise((resolve)=>{
        if(YT_READY||window.YT?.Player){YT_READY=true;resolve();return;}
        const s=document.createElement('script');
        s.src='https://www.youtube.com/iframe_api';
        window.onYouTubeIframeAPIReady=function(){
          YT_READY=true;
          resolve();
          onYouTubeIframeAPIReadyCallbacks.forEach(fn=>fn());
        };
        document.head.appendChild(s);
      });
    }
    function createPlayer(containerId, videoId, onEnded){
      if(!YT_READY && !window.YT){
        onYouTubeIframeAPIReadyCallbacks.push(()=> createPlayer(containerId, videoId, onEnded));
        return;
      }
      const player = new YT.Player(containerId, {
        width:'100%',height:'100%',videoId,
        playerVars:{rel:0,modestbranding:1,playsinline:1},
        events:{'onStateChange':(e)=>{
          if(e.data === YT.PlayerState.ENDED){ onEnded && onEnded(); }
        }}
      });
      return player;
    }

    function renderSegment(idx){
      const seg = SEGMENTS[idx];
      app.innerHTML='';
      updateBar();

      const title = document.createElement('div');
      title.className='title';
      title.textContent = `${idx+1}/${SEGMENTS.length}　${seg.title}`;

      const meta = document.createElement('div');
      meta.className='meta';
      const pillText = seg.finalOnly
        ? 'ここまでの3本すべてからの総合テストです'
        : '動画を最後まで再生するとクイズが表示されます';
      meta.innerHTML = `<span class="pill">${pillText}</span>`;

      const quiz = document.createElement('div');
      quiz.className='quiz';

      const qWrap = document.createElement('div');
      const answered = new Array(seg.questions.length).fill(false);
      const selected = new Array(seg.questions.length).fill(null);

      seg.questions.forEach((q, qi)=>{
        const qBox = document.createElement('div');
        qBox.className='q';

        const h3 = document.createElement('h3');
        h3.textContent = `Q${qi+1}. ${q.prompt}`;
        qBox.appendChild(h3);

        const list = document.createElement('div');
        list.className='choices';

        q.choices.forEach((ch, ci)=>{
          const label=document.createElement('label');
          label.className='choice';

          const input=document.createElement('input');
          input.type='radio';
          input.name=`q-${idx}-${qi}`;
          input.value=ci;
          input.addEventListener('change',()=>{ selected[qi]=ci; });

          const span=document.createElement('span');
          span.textContent=ch.text;

          label.appendChild(input);
          label.appendChild(span);
          list.appendChild(label);
        });

        const actions=document.createElement('div');
        actions.className='actions';

        const btnCheck=document.createElement('button');
        btnCheck.className='btn-primary';
        btnCheck.textContent='答え合わせ';
        btnCheck.addEventListener('click',()=>{
          if(selected[qi]===null){
            btnCheck.classList.add('btn-disabled');
            setTimeout(()=>btnCheck.classList.remove('btn-disabled'),600);
            return;
          }
          if(answered[qi]) return; // 二重採点防止
          answered[qi]=true;
          const isOK = q.choices[selected[qi]].correct===true;
          const fb=qBox.querySelector('.feedback')||document.createElement('div');
          fb.className='feedback';
          fb.innerHTML = isOK
            ? `<span class='ok'>正解！ +${q.points}点</span>　<span class='small'>${q.explanation||''}</span>`
            : `<span class='ng'>不正解</span>　<span class='small'>${q.explanation||''}</span>`;
          if(!qBox.contains(fb)) qBox.appendChild(fb);
          if(isOK) updateScore(q.points);
        });

        actions.appendChild(btnCheck);
        qBox.appendChild(list);
        qBox.appendChild(actions);
        qWrap.appendChild(qBox);
      });

      const hr=document.createElement('div');
      hr.className='hr';

      const nav=document.createElement('div');
      nav.className='actions';

      const btnNext=document.createElement('button');
      btnNext.className='btn-next';
      btnNext.textContent = (idx<SEGMENTS.length-1)?'次へ':'結果を見る';
      btnNext.addEventListener('click',()=>{
        const anyChecked = answered.some(v=>v);
        if(!anyChecked){
          btnNext.classList.add('btn-disabled');
          setTimeout(()=>btnNext.classList.remove('btn-disabled'),600);
          return;
        }
        if(idx < SEGMENTS.length-1){
          current=idx+1;
          renderSegment(current);
        } else {
          renderSummary();
        }
      });
      nav.appendChild(btnNext);

      quiz.appendChild(qWrap);
      quiz.appendChild(hr);
      quiz.appendChild(nav);

      // mount common elements
      app.appendChild(title);
      app.appendChild(meta);

      if(seg.finalOnly){
        // 総合テストは動画なし、いきなりクイズを表示
        quiz.classList.add('active');
        app.appendChild(quiz);
      } else {
        // 通常パート：YouTubeプレイヤーを表示し、再生終了でクイズ解放
        const wrap=document.createElement('div');
        wrap.className='player-wrap';

        const aspect=document.createElement('div');
        aspect.className='aspect';
        const playerBox=document.createElement('div');
        playerBox.id = `player-${idx}`;
        playerBox.style.width='100%';
        playerBox.style.height='100%';
        aspect.appendChild(playerBox);
        wrap.appendChild(aspect);

        app.appendChild(wrap);
        app.appendChild(quiz);

        loadYT().then(()=>{
          createPlayer(`player-${idx}`, seg.youtubeId, ()=>{
            quiz.classList.add('active');
            window.scrollTo({ top: app.offsetTop + wrap.offsetTop, behavior:'smooth' });
          });
        });
      }
    }

    function renderSummary(){
      app.innerHTML='';
      const box=document.createElement('div');
      box.className='summary active';

      const h2=document.createElement('h2');
      h2.textContent='結果';

      const p=document.createElement('p');
      p.innerHTML=`合計得点：<strong>${totalScore}</strong>`;

      const again=document.createElement('button');
      again.className='btn-secondary';
      again.textContent='最初からやり直す';
      again.addEventListener('click',()=>{
        totalScore=0;
        scoreBox.textContent='得点：0';
        current=0;
        renderSegment(0);
        updateBar();
      });

      box.appendChild(h2);
      box.appendChild(p);
      box.appendChild(again);
      app.appendChild(box);
      bar.style.width='100%';
    }

    // 初期表示
    renderSegment(current);
  </script>
</body>
</html>
